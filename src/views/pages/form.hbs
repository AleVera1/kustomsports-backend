{{#if status}}
<h2>Agregar Producto</h2>
<div class="row g-3">

  <form class="row g-3" action="/productos" method="POST"> 
  
    <div class="col-sm-3">
      <div class="input-group input-group-sm mb-3">
        <span class="input-group-text" id="basic-addon1">Título</span>
        <input id="input-title" type="text" name="title" required class="form-control" placeholder="Título del producto" aria-label="Título" aria-describedby="basic-addon1">
      </div>
    </div>

    <div class="col-sm-2">
      <div class="input-group input-group-sm mb-3">
          <span class="input-group-text" id="basic-addon2">Precio</span>
          <input id="input-price" type="text" name="price" required class="form-control" placeholder="Precio unitario" aria-label="Precio" aria-describedby="basic-addon1">
      </div>
    </div>  

    <div class="col-sm-3">
      <div class="input-group input-group-sm mb-3">
        <span class="input-group-text" id="basic-addon3">Thumbnail</span>
        <input id="input-img" type="text" name="thumbnail" required class="form-control" placeholder="Thumbnail (URL)" aria-label="Thumbnail" aria-describedby="basic-addon1">
      </div>
    </div>

    <div class="col-sm-3">
  <div class="input-group input-group-sm mb-3">
    <span class="input-group-text" id="basic-addon3">Stock</span>
    <input id="input-stock" type="number" name="stock" required class="form-control" placeholder="Ingresá el stock" aria-label="stock" aria-describedby="basic-addon3">
  </div>
</div>

<div class="col-sm-3">
  <div class="input-group input-group-sm mb-3">
    <span class="input-group-text" id="basic-addon3">Código</span>
    <input id="input-code" type="text" name="code" required class="form-control" placeholder="Ingresá el código" aria-label="code" aria-describedby="basic-addon3">
  </div>
</div>

<div class="col-sm-5">
  <div class="input-group input-group-sm mb-3">
    <span class="input-group-text" id="basic-addon3">Descripción</span>
    <input id="input-description" type="text" name="description" required class="form-control" placeholder="Ingresá la descripción" aria-label="description" aria-describedby="basic-addon3">
  </div>
</div>

    <div class="col-sm-2">
      <div class="d-grid gap-2">
        <button id="btn-submit" class="btn btn-primary btn-sm" type="submit">Agregar a la lista</button>
      </div>
    </div>
      
    <hr>
    <span>Chatea con otros usuarios</span>
      
    <div class="col-sm-3">
      <div class="input-group input-group-sm mb-3">
        <span class="input-group-text" id="basic-addon3">Email</span>
        <input id="input-email" type="text" name="email" required class="form-control" placeholder="Ingresá tu email" aria-label="email" aria-describedby="basic-addon1">
      </div>
    </div>

    <div class="col-sm-5">
      <div class="input-group input-group-sm mb-3">
        <span class="input-group-text" id="basic-addon3">Mensaje</span>
        <input id="input-mensaje" type="email" name="mensaje" required class="form-control" placeholder="Ingresá tu mensaje" aria-label="mensaje" aria-describedby="basic-addon1">
      </div>
    </div>


    <div class="col-sm-2">
      <div class="d-grid gap-2">
        <button id="btn-submit-mensaje" class="btn btn-success btn-sm">Enviar mensaje</button>
      </div>
    </div>
    
    <span>Historial de mensajes</span>
    
    <div id="historial-mensajes"></div>
    
    <hr>
    
    <table class="table table-sm table-hover">
    <thead>
      <tr>
        <th scope="col">#ID</th>
        <th scope="col">Nombre</th>
        <th scope="col">Precio</th>
        <th scope="col">Imagen</th>
        <th scope="col">Código</th>
        <th scope="col">Stock</th>
        <th scope="col">Descripción</th>
      </tr>
    </thead>
    <tbody id="table-body">
        
    </tbody>
  </table>
  {{else}}
    <h1>Necesitas loguearte para ver todo el contenido</h1>
    <h2>--- SERVIDOR CORRIENDO CORRECTAMENTE EN RAILWAY ---</h2>
  {{/if}}

  <script>
    const socket = io();
    const btn = document.getElementById('btn-submit');
    const btnMensaje = document.getElementById('btn-submit-mensaje');
    
    const inputTitle = document.getElementById('input-title');
    const inputPrice = document.getElementById('input-price');
    const inputImage = document.getElementById('input-img');
    const inputStock = document.getElementById('input-stock');
    const inputCode = document.getElementById('input-code');
    const inputDescription = document.getElementById('input-description');
    
    btnMensaje.addEventListener('click', (evt) => {
      evt.preventDefault();
      const email = document.getElementById('input-email').value;
      const mensaje = document.getElementById('input-mensaje').value;
      
      if (email !== '' && mensaje !== '') {
        socket.emit('nuevoMensaje', {
          "email" : email,
          "mensaje" : mensaje,
          "date" : new Date().toISOString()
        })
      }
    })
    
    
    btn.addEventListener('click', (evt) => {
      const title = inputTitle.value;
      const price = inputPrice.value;
      const image = inputImage.value;
      const code = inputCode.value;
      const stock = inputStock.value;
      const description = inputDescription.value;
      
      if (title !== '' && price !== '' && image !== '' && code !== '' && stock !== '' && description !== '') {
        socket.emit('productoAgregado',{
          "title": title,
          "price": price,
          "image": image,
          "stock": stock,
          "code": code,
          "description": description
        })
      }
    })
    
    socket.on('listaMensajesActualizada', (data) => {
      console.log(data);
      $('#historial-mensajes').empty();
      data.forEach( (mensaje) => {
        $('#historial-mensajes').append(
        `
        <small style="display:block"> - <em style="color:#9f9f9f">[${mensaje.date}]</em> <strong style="color:green">${mensaje.email}</strong>: ${mensaje.mensaje} </small>
        `
        )
      })
    })
    
    socket.on('listaMensajesBienvenida', (data) => {
      console.log(data);
      $('#historial-mensajes').empty();
      data.forEach( (mensaje) => {
        $('#historial-mensajes').append(
        `
        <small style="display:block"> - <em style="color:#9f9f9f">[${mensaje.date}]</em> <strong style="color:green">${mensaje.email}</strong>: ${mensaje.mensaje} </small>
        `
        )
      })
    })
    
    socket.on('listaActualizada', (data) => {
      $('#table-body').empty();
      data.forEach( (element) => {
        $('#table-body').append(
        `
        <tr>
            <td>${element._id}</td>
            <td>${element.title}</td>
            <td>${element.price}</td>
            <td>${element.image}</td>
            <td>${element.stock}</td>
            <td>${element.code}</td>
            <td>${element.description}</td>
        </tr>
        `
        )
      })
    })
    
    socket.on('bienvenidoLista', (data) => {
      $('#table-body').empty();
      data.forEach( (element) => {
        $('#table-body').append(
        `
        <tr>
            <td>${element._id}</td>
            <td>${element.title}</td>
            <td>${element.price}</td>
            <td>${element.image}</td>
            <td>${element.stock}</td>
            <td>${element.code}</td>
            <td>${element.description}</td>
        </tr>
        `
        )
      })
    })
    
  </script>
  </form>
</div>